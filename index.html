<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FreakyTractor</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <nav>
    <h1 class="pageTitle">freakyTractor</h1>
    <ul>
      <li><a href="index.html">home</a></li>
      <li><a href="freakytractor.html">freakyTractor</a></li>
    </ul>
  </nav>
  <canvas id="myCanvas" style="border: 1px solid orange"></canvas>
</body>
<script>
  // CANVAS VARIABLES
  const myCanvas = document.getElementById("myCanvas");
  const ctx = myCanvas.getContext("2d");

  myCanvas.width = window.innerWidth;
  myCanvas.height = window.innerHeight;

  ctx.globalCompositeOperation = "destination-over";

  const gravity = 0.07;
  const gravitySpeed = 0;
  const bounce = 0.1;

  const playerImage = new Image();
  playerImage.src = "./imgs/player.png";
  playerImage.onload = function () {
    //player
    function Player() {
      this.posx = myCanvas.width / 2;
      this.posy = myCanvas.height / 2;

      this.img = playerImage;
      this.width = 32;
      this.height = 32;
      this.speedY = 0;
      this.speedX = 0;
      this.gravity = 0.1;
      this.gravitySpeed = 0;
      this.scale = 3;
      this.scaledWidth = this.scale * this.width;
      this.scaledHeight = this.scale * this.height;
      this.isJumping = false;
      this.jumpSpeed = -5;
      this.frameCounter = 0;
      this.cycleLoop = [0, 1];
      this.currentLoopIndex = 0;

      Player.prototype.update = function () {
        ctx.drawImage(
          //image being used
          this.img,
          //xposition on image
          this.cycleLoop[this.currentLoopIndex] * this.width,
          0,
          //yposition on image
          this.width,
          this.height,
          this.posx,
          this.posy,
          this.scaledWidth,
          this.scaledHeight
        );
        // this.currentLoopIndex++;
        if(this.currentLoopIndex >= this.cycleLoop.length){
          this.currentLoopIndex = 0;
        }

        this.jump();
        
      };

      Player.prototype.newPos = function () {
        this.gravitySpeed += this.gravity;
        // this.posx += this.speedX;
        this.posy += this.speedY + this.gravitySpeed;
        this.hitBottom();
      };
      this.hitBottom = function () {
        var rockbottom = myCanvas.height - this.scaledHeight;
        // console.log(myCanvas.height);
        if (this.posy > rockbottom) {
          this.posy = rockbottom;
          this.gravitySpeed = -(this.gravitySpeed * bounce);
        }
      };

      //this function makes the player jump
      this.jump = function () {
        //check if player should be jumping
        if (this.isJumping) {
          
          //stop the player jumping again
          // this.isJumping = false;
          //check how many frames the player has been jumping
          if (this.frameCounter < 500) {
            this.posy += this.jumpSpeed;
            console.log(this.posy + "UP DOWN Y pos");
          }
          
        };
      }

      Player.prototype.move = function () {
        //player.movement
        addEventListener("keydown", (e) => {
          if (e.keyCode == 65) {
            this.posx += -15;
            console.log(this.posx + "Sideways xpos");
          }
          if (e.keyCode == 68) {
            this.posx += 15;
            console.log(this.posx + "Sideways xpos");
          }
          if (e.keyCode == 87) {
            console.log("w key was presssed");
            this.isJumping = true;
            this.frameCounter = 0;

          }
        });
        
      };
    }

    const player = new Player();
    player.move();

   



    //animationloop
    function animate() {
      window.requestAnimationFrame(animate);
      ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);
      player.newPos();
      player.update();
      player.frameCounter++;
      // if(player.frameCounter %  5==0){
      //   player.currentLoopIndex++;
      // }
      player.currentLoopIndex++;

    }

    window.requestAnimationFrame(animate);
  };

</script>

</html>